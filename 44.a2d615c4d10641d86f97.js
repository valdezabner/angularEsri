(window.webpackJsonp=window.webpackJsonp||[]).push([[44,127,128],{"1kEK":function(t,e,i){"use strict";i.d(e,"a",function(){return s});const s={convertToGEGeometry:function(t,e){return null==e?null:t.convertJSONToGeometry(e)},exportPoint:function(t,e,i){const s=new n(t.getPointX(e),t.getPointY(e),i),r=t.hasZ(e),o=t.hasM(e);return r&&(s.z=t.getPointZ(e)),o&&(s.m=t.getPointM(e)),s},exportPolygon:function(t,e,i){return new r(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))},exportPolyline:function(t,e,i){return new o(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))},exportMultipoint:function(t,e,i){return new a(t.exportPoints(e),i,t.hasZ(e),t.hasM(e))},exportExtent:function(t,e,i){const s=t.hasZ(e),n=t.hasM(e),r=new c(t.getXMin(e),t.getYMin(e),t.getXMax(e),t.getYMax(e),i);if(s){const i=t.getZExtent(e);r.zmin=i.vmin,r.zmax=i.vmax}if(n){const i=t.getMExtent(e);r.mmin=i.vmin,r.mmax=i.vmax}return r}};class n{constructor(t,e,i){this.x=t,this.y=e,this.spatialReference=i,this.z=void 0,this.m=void 0}}class r{constructor(t,e,i,s){this.rings=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),s&&(this.hasM=s)}}class o{constructor(t,e,i,s){this.paths=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),s&&(this.hasM=s)}}class a{constructor(t,e,i,s){this.points=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),s&&(this.hasM=s)}}class c{constructor(t,e,i,s,n){this.xmin=t,this.ymin=e,this.xmax=i,this.ymax=s,this.spatialReference=n,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},"2X7Z":function(t,e,i){"use strict";function s(t,e){return t?e?4:3:e?3:2}function n(t,e,i,n,a){if(!e||!e.lengths.length)return null;const c="upperLeft"===(null==a?void 0:a.originPosition)?-1:1;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const u=t.coords,h=[],l=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:d,coords:f}=e,p=s(i,n);let m=0;for(const s of d){const t=r(l,f,m,s,i,n,c);t&&h.push(t),m+=s*p}if(h.sort((t,e)=>{let s=c*t[2]-c*e[2];return 0===s&&i&&(s=t[4]-e[4]),s}),h.length){let t=6*h[0][2];u[0]=h[0][0]/t,u[1]=h[0][1]/t,i&&(t=6*h[0][4],u[2]=0!==t?h[0][3]/t:0),(u[0]<l[0]||u[0]>l[1]||u[1]<l[2]||u[1]>l[3]||i&&(u[2]<l[4]||u[2]>l[5]))&&(u.length=0)}if(!u.length){const t=e.lengths[0]?o(f,0,d[0],i,n):null;if(!t)return null;u[0]=t[0],u[1]=t[1],i&&t.length>2&&(u[2]=t[2])}return t}function r(t,e,i,n,r,o,a=1){const c=s(r,o);let u=i,h=i+c,l=0,d=0,f=0,p=0,m=0;for(let s=0,b=n-1;s<b;s++,u+=c,h+=c){const i=e[u],s=e[u+1],n=e[u+2],o=e[h],a=e[h+1],c=e[h+2];let g=i*a-o*s;p+=g,l+=(i+o)*g,d+=(s+a)*g,r&&(g=i*c-o*n,f+=(n+c)*g,m+=g),i<t[0]&&(t[0]=i),i>t[1]&&(t[1]=i),s<t[2]&&(t[2]=s),s>t[3]&&(t[3]=s),r&&(n<t[4]&&(t[4]=n),n>t[5]&&(t[5]=n))}if(p*a>0&&(p*=-1),m*a>0&&(m*=-1),!p)return null;const g=[l,d,.5*p];return r&&(g[3]=f,g[4]=.5*m),g}function o(t,e,i,n,r){const o=s(n,r);let l=e,d=e+o,f=0,p=0,m=0,g=0;for(let s=0,b=i-1;s<b;s++,l+=o,d+=o){const e=t[l],i=t[l+1],s=t[l+2],r=t[d],o=t[d+1],b=t[d+2],y=n?c(e,i,s,r,o,b):a(e,i,r,o);if(y)if(f+=y,n){const t=h(e,i,s,r,o,b);p+=y*t[0],m+=y*t[1],g+=y*t[2]}else{const t=u(e,i,r,o);p+=y*t[0],m+=y*t[1]}}return f>0?n?[p/f,m/f,g/f]:[p/f,m/f]:i>0?n?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function a(t,e,i,s){const n=i-t,r=s-e;return Math.sqrt(n*n+r*r)}function c(t,e,i,s,n,r){const o=s-t,a=n-e,c=r-i;return Math.sqrt(o*o+a*a+c*c)}function u(t,e,i,s){return[t+.5*(i-t),e+.5*(s-e)]}function h(t,e,i,s,n,r){return[t+.5*(s-t),e+.5*(n-e),i+.5*(r-i)]}i.d(e,"a",function(){return n})},AIxD:function(t,e,i){"use strict";i.d(e,"a",function(){return x}),i.d(e,"b",function(){return g}),i.d(e,"c",function(){return a}),i.d(e,"d",function(){return O}),i.d(e,"e",function(){return j}),i.d(e,"f",function(){return v}),i.d(e,"g",function(){return I});var s=i("qatw");const n=(t,e,i)=>[e,i],r=(t,e,i)=>[e,i,t[2]],o=(t,e,i)=>[e,i,t[2],t[3]];function a(t){return t?{originPosition:"upper-left"===t.originPosition?"upperLeft":"lower-left"===t.originPosition?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function c({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function u({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function h(t,e,i){const s=[];let n,r,o,a;for(let h=0;h<i.length;h++){const l=i[h];h>0?(o=c(t,l[0]),a=u(t,l[1]),o===n&&a===r||(s.push(e(l,o-n,a-r)),n=o,r=a)):(n=c(t,l[0]),r=u(t,l[1]),s.push(e(l,n,r)))}return s.length>0?s:null}function l({scale:t,translate:e},i){return i*t[0]+e[0]}function d({scale:t,translate:e},i){return e[1]-i*t[1]}function f(t,e,i){const s=new Array(i.length);if(!i.length)return s;const[n,r]=t.scale;let o=l(t,i[0][0]),a=d(t,i[0][1]);s[0]=e(i[0],o,a);for(let c=1;c<i.length;c++){const t=i[c];o+=t[0]*n,a-=t[1]*r,s[c]=e(t,o,a)}return s}function p(t,e,i){const s=new Array(i.length);for(let n=0;n<i.length;n++)s[n]=f(t,e,i[n]);return s}function m(t,e,i,s,a){return e.points=function(t,e,i,s){return h(t,i?s?o:r:s?r:n,e)}(t,i.points,s,a),e}function g(t,e,i,s,n){return e.x=c(t,i.x),e.y=u(t,i.y),e!==i&&(s&&(e.z=i.z),n&&(e.m=i.m)),e}function b(t,e,i,s,a){const c=function(t,e,i,s){const a=[],c=i?s?o:r:s?r:n;for(let n=0;n<e.length;n++){const i=h(t,c,e[n]);i&&i.length>=3&&a.push(i)}return a.length?a:null}(t,i.rings,s,a);return c?(e.rings=c,e):null}function y(t,e,i,s,a){const c=function(t,e,i,s){const a=[],c=i?s?o:r:s?r:n;for(let n=0;n<e.length;n++){const i=h(t,c,e[n]);i&&i.length>=2&&a.push(i)}return a.length?a:null}(t,i.paths,s,a);return c?(e.paths=c,e):null}function x(t,e){return t&&e?Object(s.f)(e)?g(t,{},e,!1,!1):Object(s.h)(e)?y(t,{},e,!1,!1):Object(s.g)(e)?b(t,{},e,!1,!1):Object(s.e)(e)?m(t,{},e,!1,!1):Object(s.d)(e)?((n={}).xmin=c(i=t,(r=e).xmin),n.ymin=u(i,r.ymin),n.xmax=c(i,r.xmax),n.ymax=u(i,r.ymax),n):null:null;var i,n,r}function O(t,e,i,s,a){return e.points=function(t,e,i,s){return f(t,i?s?o:r:s?r:n,e)}(t,i.points,s,a),e}function j(t,e,i,s,n){return e.x=l(t,i.x),e.y=d(t,i.y),e!==i&&(s&&(e.z=i.z),n&&(e.m=i.m)),e}function v(t,e,i,s,a){return e.rings=function(t,e,i,s){return p(t,i?s?o:r:s?r:n,e)}(t,i.rings,s,a),e}function I(t,e,i,s,a){return e.paths=function(t,e,i,s){return p(t,i?s?o:r:s?r:n,e)}(t,i.paths,s,a),e}},BMSW:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i("wSAH"),n=i("zna6");const r={minX:0,minY:0,maxX:0,maxY:0};class o{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new n.a(9,Object(s.a)("csp-restrictions")?t=>({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const t=new Array(this._idByBounds.size);let e=0;this._idByBounds.forEach((i,s)=>{t[e++]=s}),this._indexInvalid=!1,this._index.clear(),this._index.load(t)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter(t=>this._idByBounds.has(t))),this._boundsToLoad.length=0)}}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(t){const e=this._boundsById.get(t);this._boundsById.delete(t),e&&(this._idByBounds.delete(e),this._indexInvalid||this._index.remove(e))}forEachInBounds(t,e){this._loadIndex(),function(t,e,i){r.minX=e[0],r.minY=e[1],r.maxX=e[2],r.maxY=e[3],t.search(r,i)}(this._index,t,t=>e(this._idByBounds.get(t)))}get(t){return this._boundsById.get(t)}has(t){return this._boundsById.has(t)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(t,e){if(!this._indexInvalid){const e=this._boundsById.get(t);e&&(this._index.remove(e),this._idByBounds.delete(e))}this._boundsById.set(t,e),e&&(this._idByBounds.set(e,t),this._indexInvalid||(this._boundsToLoad.push(e),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},HsO1:function(t,e,i){"use strict";i.d(e,"a",function(){return d}),i.d(e,"b",function(){return g}),i.d(e,"c",function(){return y});var s=i("HaE+"),n=i("f4Nx"),r=i("l4ZG"),o=i("gYg2"),a=i("1kEK");const c=[0,0];function u(t,e){if(!e)return null;if("x"in e){const i={x:0,y:0};return[i.x,i.y]=t(e.x,e.y,c),null!=e.z&&(i.z=e.z),null!=e.m&&(i.m=e.m),i}if("xmin"in e){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=t(e.xmin,e.ymin,c),[i.xmax,i.ymax]=t(e.xmax,e.ymax,c),e.hasZ&&(i.zmin=e.zmin,i.zmax=e.zmax,i.hasZ=!0),e.hasM&&(i.mmin=e.mmin,i.mmax=e.mmax,i.hasM=!0),i}return"rings"in e?{rings:h(e.rings,t),hasM:e.hasM,hasZ:e.hasZ}:"paths"in e?{paths:h(e.paths,t),hasM:e.hasM,hasZ:e.hasZ}:"points"in e?{points:l(e.points,t),hasM:e.hasM,hasZ:e.hasZ}:void 0}function h(t,e){const i=[];for(const s of t)i.push(l(s,e));return i}function l(t,e){const i=[];for(const s of t){const t=e(s[0],s[1],[0,0]);i.push(t),s.length>2&&t.push(s[2]),s.length>3&&t.push(s[3])}return i}function d(t,e){return f.apply(this,arguments)}function f(){return(f=Object(s.a)(function*(t,e){if(!e)return;const i=Array.isArray(t)?t.map(t=>{var e;return null==(e=t.geometry)?void 0:e.spatialReference}):[t];yield Object(o.c)(i.map(t=>({source:t,dest:e})))})).apply(this,arguments)}const p=u.bind(null,r.c),m=u.bind(null,r.f);function g(t,e,i){return t?(i||(i=e,e=t.spatialReference),Object(n.i)(e)&&Object(n.i)(i)&&!Object(n.c)(e,i)?Object(r.a)(e,i)?Object(n.m)(i)?p(t):m(t):Object(o.i)(a.a,[t],e,i,null)[0]:t):t}const b=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(t,e,i){var r=this;return Object(s.a)(function*(){!t||!t.length||!e||!i||Object(n.c)(e,i);const s={geometries:t,inSpatialReference:e,outSpatialReference:i,resolve:null};return r._jobs.push(s),new Promise(t=>{s.resolve=t,null===r._timer&&(r._timer=setTimeout(r._process,10))})})()}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:e,inSpatialReference:i,outSpatialReference:s,resolve:c}=t;Object(r.a)(i,s)?Object(n.m)(s)?c(e.map(p)):c(e.map(m)):c(Object(o.i)(a.a,e,i,s,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function y(t,e,i){return x.apply(this,arguments)}function x(){return(x=Object(s.a)(function*(t,e,i){return b.push(t,e,i)})).apply(this,arguments)}},RjdO:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i("X2wA"),n=Object(s.b)(function(t){var e;void 0!==(e=function(){function t(i,s,n,r,o){for(;r>n;){if(r-n>600){var a=r-n+1,c=s-n+1,u=Math.log(a),h=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*h*(a-h)/a)*(c-a/2<0?-1:1);t(i,s,Math.max(n,Math.floor(s-c*h/a+l)),Math.min(r,Math.floor(s+(a-c)*h/a+l)),o)}var d=i[s],f=n,p=r;for(e(i,n,s),o(i[r],d)>0&&e(i,n,r);f<p;){for(e(i,f,p),f++,p--;o(i[f],d)<0;)f++;for(;o(i[p],d)>0;)p--}0===o(i[n],d)?e(i,n,p):e(i,++p,r),p<=s&&(n=p+1),s<=p&&(r=p-1)}}function e(t,e,i){var s=t[e];t[e]=t[i],t[i]=s}function i(t,e){return t<e?-1:t>e?1:0}return function(e,s,n,r,o){t(e,s,n||0,r||e.length-1,o||i)}}())&&(t.exports=e)})},X2wA:function(t,e,i){"use strict";function s(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e,i){return t(i={path:e,exports:{},require:function(t,e){return r()}},i.exports),i.exports}function r(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}i.d(e,"a",function(){return r}),i.d(e,"b",function(){return n}),i.d(e,"c",function(){return s}),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self},"YV+X":function(t,e,i){"use strict";i.r(e),i.d(e,"FeatureServiceSnappingSourceWorker",function(){return Q});var s=i("HaE+"),n=i("pO5D"),r=(i("wSAH"),i("srIe")),o=i("6S2I"),a=(i("zqDF"),i("WbKI")),c=i("04ZG"),u=(i("4EHJ"),i("ju1D"),i("9AIY"),i("9MzC")),h=i("WZb1"),l=i("zm0L"),d=i("r0DZ"),f=i("N5XI"),p=i("+AYZ"),m=i("xk++"),g=i("00eo"),b=i("3/ME"),y=i("ZRfE"),x=i("ZBG3"),O=i("xkkJ"),j=i("tQ+6"),v=i("OvF4"),I=i("kYAx"),_=i("ZlUD"),S=i("hufI"),F=i("6fyR"),M=i("/CmD");let w=class extends M.a{constructor(){super(...arguments),this.updating=!1,this.pending=[]}push(t,e){this.pending.push({promise:t,callback:e}),1===this.pending.length&&this.process()}process(){if(!this.pending.length)return void(this.updating=!1);this.updating=!0;const t=this.pending[0];t.promise.then(e=>t.callback(e)).catch(()=>{}).then(()=>{this.pending.shift(),this.process()})}};Object(n.a)([Object(a.b)()],w.prototype,"updating",void 0),w=Object(n.a)([Object(c.a)("esri.core.AsyncSequence")],w);var T=i("kJYu"),B=i("eSsm");class C{constructor(t,e){this.data=t,this.resolution=e,this.state={type:0},this.alive=!0}process(t){switch(this.state.type){case 0:return this.state=this.gotoFetchCount(this.state,t),this.state.task.promise.then(t.resume,t.resume);case 1:break;case 2:return this.state=this.gotoFetchFeatures(this.state,t),this.state.task.promise.then(t.resume,t.resume);case 3:break;case 4:this.state=this.goToDone(this.state,t)}return null}get debugInfo(){return{data:this.data,featureCount:this.featureCount,state:this.stateToString}}get featureCount(){switch(this.state.type){case 0:case 1:return 0;case 2:return this.state.featureCount;case 3:return this.state.previous.featureCount;case 4:return this.state.features.length;case 5:return this.state.previous.features.length}}get stateToString(){switch(this.state.type){case 0:return"created";case 1:return"fetch-count";case 2:return"fetched-count";case 3:return"fetch-features";case 4:return"fetched-features";case 5:return"done"}}gotoFetchCount(t,e){var i=this;return{type:1,previous:t,task:Object(u.h)(function(){var t=Object(s.a)(function*(t){const s=yield Object(B.d)(e.fetchCount(i,t));1===i.state.type&&(i.state=i.gotoFetchedCount(i.state,s.ok?s.value:1/0))});return function(e){return t.apply(this,arguments)}}())}}gotoFetchedCount(t,e){return{type:2,featureCount:e,previous:t}}gotoFetchFeatures(t,e){var i=this;return{type:3,previous:t,task:Object(u.h)(function(){var n=Object(s.a)(function*(s){const n=yield Object(B.d)(e.fetchFeatures(i,t.featureCount,s));3===i.state.type&&(i.state=i.gotoFetchedFeatures(i.state,n.ok?n.value:[]))});return function(t){return n.apply(this,arguments)}}())}}gotoFetchedFeatures(t,e){return{type:4,previous:t,features:e}}goToDone(t,e){return e.finish(this,t.features),{type:5,previous:t}}reset(){const t=this.state;switch(this.state={type:0},t.type){case 0:case 2:case 4:case 5:break;case 1:case 3:t.task.abort()}}intersects(t){return!(!Object(r.h)(t)&&this.data.extent)||(Object(I.i)(t,E),Object(I.l)(this.data.extent,E))}}const E=Object(I.e)(),P=o.a.getLogger("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher");let A=class extends T.a{constructor(t){super(t),this.tilesOfInterest=[],this.availability=0,this.pendingTiles=new Map,this.pendingEdits=new w,this.pendingEditsAbortController=Object(u.d)()}get minimumVerticesPerFeature(){var t;switch(null==(t=this.store)?void 0:t.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}set filter(t){const e=this._get("filter"),i=this.filterProperties(t);JSON.stringify(e)!==JSON.stringify(i)&&this._set("filter",i)}set customParameters(t){const e=this._get("customParameters");JSON.stringify(e)!==JSON.stringify(t)&&this._set("customParameters",t)}get configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(t){const e=this._get("tileInfo");e!==t&&(Object(r.i)(t)&&Object(r.i)(e)&&JSON.stringify(t)===JSON.stringify(e)||(this._set("tileInfo",t),this.store.tileInfo=t))}set tileSize(t){this._get("tileSize")!==t&&this._set("tileSize",t)}get updating(){return this.updatingHandles.updating||this.pendingEdits.updating}initialize(){this.initializeFetchExtent(),this.updatingHandles.add(this,"configuration",()=>this.refresh()),this.updatingHandles.add(this,"tilesOfInterest",(t,e)=>{Object(j.c)(t,e,({id:t},{id:e})=>t===e)||this.process()},1)}destroy(){this.pendingTiles.forEach(t=>this.deletePendingTile(t)),this.pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this.pendingEditsAbortController.abort(),this.pendingEditsAbortController=null}refresh(){this.store.refresh(),this.pendingTiles.forEach(t=>this.deletePendingTile(t)),this.process()}applyEdits(t){var e=this;this.pendingEdits.push(t,function(){var t=Object(s.a)(function*(t){if(0!==t.addedFeatures.length||0!==t.updatedFeatures.length||0!==t.deletedFeatures.length){for(const[,t]of e.pendingTiles)t.reset();yield e.updatingHandles.addPromise(e.store.processEdits(t,(t,i)=>e.queryFeaturesById(t,i),e.pendingEditsAbortController.signal)),e.processPendingTiles()}});return function(e){return t.apply(this,arguments)}}())}initializeFetchExtent(){var t=this;if(!this.capabilities.query.supportsExtent)return;const e=Object(u.h)(function(){var e=Object(s.a)(function*(e){try{var i;const s=yield Object(F.executeQueryForExtent)(t.url,new m.a({where:"1=1",outSpatialReference:t.spatialReference,cacheHint:!!t.capabilities.query.supportsCacheHint||void 0}),{query:t.configuration.customParameters,signal:e});t.store.extent=v.a.fromJSON(null==(i=s.data)?void 0:i.extent)}catch(s){Object(u.t)(s),P.error("Failed to fetch data extent",s)}});return function(t){return e.apply(this,arguments)}}());this.updatingHandles.addPromise(e.promise.then(()=>this.process())),this.handles.add(Object(O.b)(()=>e.abort())),this.fetchExtentTask=e}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this.pendingTiles.values()).map(t=>t.debugInfo),storedTiles:this.store.debugInfo}}process(){!Object(r.i)(this.fetchExtentTask)||this.fetchExtentTask.finished?(this.markTilesNotAlive(),this.createPendingTiles(),this.deletePendingTiles(),this.processPendingTiles()):this.setAvailability(0)}markTilesNotAlive(){for(const[,t]of this.pendingTiles)t.alive=!1}createPendingTiles(){const t=this.collectMissingTilesInfo();if(this.setAvailability(Object(r.h)(t)?1:t.coveredArea/t.fullArea),!Object(r.h)(t))for(const{data:e,resolution:i}of t.missingTiles){const t=this.pendingTiles.get(e.id);t?(t.resolution=i,t.alive=!0):this.createPendingTile(e,i)}}collectMissingTilesInfo(){let t=null;for(let e=this.tilesOfInterest.length-1;e>=0;e--){const i=this.store.process(this.tilesOfInterest[e],(t,e)=>this.verifyTileComplexity(t,e));Object(r.h)(t)?t=i:t.prepend(i)}return t}deletePendingTiles(){for(const[,t]of this.pendingTiles)t.alive||this.deletePendingTile(t)}processPendingTiles(){const t={fetchCount:(t,e)=>this.fetchCount(t,e),fetchFeatures:(t,e,i)=>this.fetchFeatures(t,e,i),finish:(t,e)=>this.finishPendingTile(t,e),resume:()=>this.processPendingTiles()};if(this.ensureFetchAllCounts(t))for(const[,e]of this.pendingTiles)this.verifyTileComplexity(this.store.getFeatureCount(e.data),e.resolution)&&this.updatingHandles.addPromise(e.process(t))}verifyTileComplexity(t,e){return this.verifyVertexComplexity(t)&&this.verifyFeatureDensity(t,e)}verifyVertexComplexity(t){return t*this.minimumVerticesPerFeature<R}verifyFeatureDensity(t,e){if(Object(r.h)(this.tileInfo))return!1;const i=this.tileSize*e;return t*(N/(i*i))<X}ensureFetchAllCounts(t){let e=!0;for(const[,i]of this.pendingTiles)i.state.type<2&&this.updatingHandles.addPromise(i.process(t)),i.state.type<=1&&(e=!1);return e}finishPendingTile(t,e){this.store.add(t.data,e),this.deletePendingTile(t),this.updateAvailability()}updateAvailability(){const t=this.collectMissingTilesInfo();this.setAvailability(Object(r.h)(t)?1:t.coveredArea/t.fullArea)}setAvailability(t){this._set("availability",t)}createPendingTile(t,e){const i=new C(t,e);return this.pendingTiles.set(t.id,i),i}deletePendingTile(t){t.reset(),this.pendingTiles.delete(t.data.id)}fetchCount(t,e){var i=this;return Object(s.a)(function*(){return i.store.fetchCount(t.data,i.url,i.createCountQuery(t),{query:i.customParameters,timeout:Y,signal:e})})()}fetchFeatures(t,e,i){var n=this;return Object(s.a)(function*(){let s,o=0,a=0,c=e;for(;;){const u=n.createFeaturesQuery(t),h=n.setPagingParameters(u,o,c),{features:l,exceededTransferLimit:d}=yield n.queryFeatures(u,i);if(h&&(o+=Object(r.o)(u.num)),a+=l.length,s=s?s.concat(l):l,c=e-a,!h||!d||c<=0)return s}})()}filterProperties(t){return Object(r.h)(t)?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:t.where||"1=1",timeExtent:t.timeExtent,gdbVersion:t.gdbVersion}}queryFeaturesById(t,e){const i=this.createFeaturesQuery(null);return i.objectIds=t,this.queryFeatures(i,e)}queryFeatures(t,e){return this.capabilities.query.supportsFormatPBF?this.queryFeaturesPBF(t,e):this.queryFeaturesJSON(t,e)}queryFeaturesPBF(t,e){var i=this;return Object(s.a)(function*(){const{sourceSpatialReference:s}=i,{data:n}=yield Object(F.executeQueryPBF)(i.url,t,new S.b({sourceSpatialReference:s}),{query:i.configuration.customParameters,timeout:Y,signal:e});return Object(_.y)(n)})()}queryFeaturesJSON(t,e){var i=this;return Object(s.a)(function*(){const{sourceSpatialReference:s}=i,{data:n}=yield Object(F.executeQuery)(i.url,t,s,{query:i.configuration.customParameters,timeout:Y,signal:e});return Object(_.b)(n,i.objectIdField)})()}createCountQuery(t){const e=this.createBaseQuery(t);return this.capabilities.query.supportsCacheHint&&(e.cacheHint=!0),e}createFeaturesQuery(t){const e=this.createBaseQuery(t);return e.outFields=[this.objectIdField],e.returnGeometry=!0,Object(r.i)(t)&&(this.capabilities.query.supportsResultType?e.resultType="tile":this.capabilities.query.supportsCacheHint&&(e.cacheHint=!0)),e}createBaseQuery(t){const e=new m.a({returnZ:!1,returnM:!1,geometry:Object(r.i)(this.tileInfo)&&Object(r.i)(t)?Object(I.n)(t.data.extent,this.tileInfo.spatialReference):void 0}),i=this.configuration.filter;return Object(r.i)(i)&&(e.where=i.where,e.gdbVersion=i.gdbVersion,e.timeExtent=i.timeExtent),e.outSpatialReference=this.spatialReference,e}setPagingParameters(t,e,i){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:s,supportsCacheHint:n,tileMaxRecordCount:r,maxRecordCount:o,supportsResultType:a}=this.capabilities.query,c=s?m.a.MAX_MAX_RECORD_COUNT_FACTOR:1,u=c*((a||n)&&r?r:o||z);return t.start=e,s?(t.maxRecordCountFactor=Math.min(c,Math.ceil(i/u)),t.num=Math.min(i,t.maxRecordCountFactor*u)):t.num=Math.min(i,u),!0}};Object(n.a)([Object(a.b)({constructOnly:!0})],A.prototype,"url",void 0),Object(n.a)([Object(a.b)({constructOnly:!0})],A.prototype,"objectIdField",void 0),Object(n.a)([Object(a.b)({constructOnly:!0})],A.prototype,"capabilities",void 0),Object(n.a)([Object(a.b)({constructOnly:!0})],A.prototype,"sourceSpatialReference",void 0),Object(n.a)([Object(a.b)({constructOnly:!0})],A.prototype,"spatialReference",void 0),Object(n.a)([Object(a.b)({constructOnly:!0})],A.prototype,"store",void 0),Object(n.a)([Object(a.b)({readOnly:!0})],A.prototype,"minimumVerticesPerFeature",null),Object(n.a)([Object(a.b)()],A.prototype,"filter",null),Object(n.a)([Object(a.b)()],A.prototype,"customParameters",null),Object(n.a)([Object(a.b)({readOnly:!0})],A.prototype,"configuration",null),Object(n.a)([Object(a.b)()],A.prototype,"tileInfo",null),Object(n.a)([Object(a.b)()],A.prototype,"tileSize",null),Object(n.a)([Object(a.b)()],A.prototype,"tilesOfInterest",void 0),Object(n.a)([Object(a.b)({readOnly:!0})],A.prototype,"updating",null),Object(n.a)([Object(a.b)({readOnly:!0})],A.prototype,"availability",void 0),A=Object(n.a)([Object(c.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],A);const z=2e3,Y=6e5,R=1e6,N=25,X=1;var Z=i("8Lmx"),k=i("BMSW");class q{constructor(){this._store=new Map,this._byteSize=0}set(t,e){this.delete(t),this._store.set(t,e),this._byteSize+=e.byteSize}delete(t){const e=this._store.get(t);return!!this._store.delete(t)&&(this._byteSize-=e.byteSize,!0)}get(t){return this.used(t),this._store.get(t)}has(t){return this.used(t),this._store.has(t)}clear(){this._store.clear()}applyByteSizeLimit(t,e){for(const[i,s]of this._store){if(this._byteSize<=t)break;this.delete(i),e(s)}}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}used(t){const e=this._store.get(t);e&&(this._store.delete(t),this._store.set(t,e))}}let H=class extends M.a{constructor(t){super(t),this.tileInfo=null,this.extent=null,this.maximumByteSize=10485760,this.tileBounds=new k.a,this.tiles=new q,this.refCounts=new Map,this.tileFeatureCounts=new Map,this.tmpBoundingRect=Object(I.e)()}add(t,e){const i=[];for(const s of e)0===this.referenceFeature(s.objectId)&&i.push(s);this.addTileStorage(t,new Set(e.map(({objectId:t})=>t)),this.byteSizeOfFeatures(e)),this.featureStore.addMany(i),this.tiles.applyByteSizeLimit(this.maximumByteSize,t=>this.removeTileStorage(t))}destroy(){this.clear(),this.tileFeatureCounts.clear()}clear(){this.featureStore.clear(),this.tileBounds.clear(),this.tiles.clear(),this.refCounts.clear()}refresh(){this.clear(),this.tileFeatureCounts.clear()}processEdits(t,e,i){return this.processEditsDelete(t.deletedFeatures.concat(t.updatedFeatures)),this.processEditsRefetch(t.addedFeatures.concat(t.updatedFeatures),e,i)}addTileStorage(t,e,i){this.tiles.set(t.id,new L(t,e,i)),this.tileBounds.set(t.id,t.extent),this.tileFeatureCounts.set(t.id,e.size)}remove({id:t}){const e=this.tiles.get(t);e&&this.removeTileStorage(e)}removeTileStorage(t){const e=[];for(const s of t.objectIds)1===this.unreferenceFeature(s)&&e.push(s);this.featureStore.removeManyById(e);const i=t.data.id;this.tiles.delete(i),this.tileBounds.delete(i)}processEditsDelete(t){this.featureStore.removeManyById(t);for(const[,e]of this.tiles){for(const i of t)e.objectIds.delete(i);this.tileFeatureCounts.set(e.data.id,e.objectIds.size)}for(const e of t)this.refCounts.delete(e)}processEditsRefetch(t,e,i){var n=this;return Object(s.a)(function*(){const s=(yield e(t,i)).features,{hasZ:r,hasM:o}=n.featureStore;for(const t of s){const e=Object(_.r)(n.tmpBoundingRect,t.geometry,r,o);n.tileBounds.forEachInBounds(e,e=>{const i=n.tiles.get(e);n.featureStore.add(t),i.objectIds.has(t.objectId)||(i.objectIds.add(t.objectId),n.referenceFeature(t.objectId),n.tileFeatureCounts.set(i.data.id,i.objectIds.size))})}})()}process(t,e=(()=>!0)){if(Object(r.h)(this.tileInfo)||!t.extent||Object(r.i)(this.extent)&&!Object(I.l)(Object(I.i)(this.extent,this.tmpBoundingRect),t.extent))return new V(t);if(this.tiles.has(t.id))return new V(t);const i=this.createTileTree(t,this.tileInfo);return this.simplify(i,e,null,0,1),this.collectMissingTiles(t,i,this.tileInfo)}get debugInfo(){return Array.from(this.tiles.values()).map(({data:t})=>({data:t,featureCount:this.tileFeatureCounts.get(t.id)||0}))}getFeatureCount(t){const e=this.tileFeatureCounts.get(t.id);return null!=e?e:0}fetchCount(t,e,i,n){var r=this;return Object(s.a)(function*(){const s=r.tileFeatureCounts.get(t.id);if(null!=s)return s;const o=yield Object(F.executeQueryForCount)(e,i,n);return r.tileFeatureCounts.set(t.id,o.data.count),o.data.count})()}createTileTree(t,e){const i=new J(t.level,t.row,t.col);return e.updateTileInfo(i,1),this.tileBounds.forEachInBounds(t.extent,s=>{const n=this.tiles.get(s).data;this.tilesAreRelated(t,n)&&this.populateChildren(i,n,e,this.tileFeatureCounts.get(n.id)||0)}),i}tilesAreRelated(t,e){if(!t||!e)return!1;if(t.level===e.level)return t.row===e.row&&t.col===e.col;const i=t.level<e.level,s=i?t:e,n=i?e:t,r=1<<n.level-s.level;return Math.floor(n.row/r)===s.row&&Math.floor(n.col/r)===s.col}populateChildren(t,e,i,s){const n=e.level-t.level-1;if(n<0)return void(t.isLeaf=!0);const o=e.row>>n,a=e.col>>n,c=a-(t.col<<1)+(o-(t.row<<1)<<1),u=t.children[c];if(Object(r.i)(u))this.populateChildren(u,e,i,s);else{const n=new J(t.level+1,o,a);i.updateTileInfo(n,1),t.children[c]=n,this.populateChildren(n,e,i,s)}}simplify(t,e,i,s,n){const o=n*n;if(t.isLeaf)return e(this.getFeatureCount(t),n)?0:(this.remove(t),Object(r.i)(i)&&(i.children[s]=null),o);const a=n/2,c=a*a;let u=0;for(let h=0;h<t.children.length;h++){const i=t.children[h];u+=Object(r.i)(i)?this.simplify(i,e,t,h,a):c}return 0===u?this.mergeChildren(t):1-u/o<G&&(this.purge(t),Object(r.i)(i)&&(i.children[s]=null),u=o),u}mergeChildren(t){const e=new Set;let i=0;this.forEachLeaf(t,t=>{const s=this.tiles.get(t.id);if(s){i+=s.byteSize;for(const t of s.objectIds)e.has(t)||(e.add(t),this.referenceFeature(t));this.remove(t)}}),this.addTileStorage(t,e,i),t.isLeaf=!0,t.children[0]=t.children[1]=t.children[2]=t.children[3]=null,this.tileFeatureCounts.set(t.id,e.size)}forEachLeaf(t,e){for(const i of t.children)Object(r.h)(i)||(i.isLeaf?e(i):this.forEachLeaf(i,e))}purge(t){if(!Object(r.h)(t))if(t.isLeaf)this.remove(t);else for(let e=0;e<t.children.length;e++)this.purge(t.children[e]),t.children[e]=null}collectMissingTiles(t,e,i){const s=new D(i,t,this.extent);return this.collectMissingTilesRecurse(e,s,1),s.info}collectMissingTilesRecurse(t,e,i){if(t.isLeaf)return;if(!t.hasChildren)return void e.addMissing(t.level,t.row,t.col,i);const s=i/2;for(let n=0;n<t.children.length;n++){const i=t.children[n];Object(r.h)(i)?e.addMissing(t.level+1,(t.row<<1)+((2&n)>>1),(t.col<<1)+(1&n),s):this.collectMissingTilesRecurse(i,e,s)}}referenceFeature(t){const e=(this.refCounts.get(t)||0)+1;return this.refCounts.set(t,e),1===e?0:2}unreferenceFeature(t){const e=(this.refCounts.get(t)||0)-1;return 0===e?(this.refCounts.delete(t),1):(e>0&&this.refCounts.set(t,e),2)}byteSizeOfFeatures(t){let e=0;for(const i of t)e+=this.byteSizeOfFeature(i);return e}byteSizeOfFeature(t){return 32+this.byteSizeOfGeometry(t.geometry)+Object(Z.a)(t.attributes)}byteSizeOfGeometry(t){if(!t)return 0;const e=Object(Z.b)(t.lengths,4);return 32+Object(Z.b)(t.coords,8)+e}get test(){return{tiles:Array.from(this.tiles.values()).map(t=>`${t.data.id}:[${Array.from(t.objectIds)}]`),featureReferences:Array.from(this.refCounts.keys()).map(t=>`${t}:${this.refCounts.get(t)}`)}}};Object(n.a)([Object(a.b)({constructOnly:!0})],H.prototype,"featureStore",void 0),Object(n.a)([Object(a.b)()],H.prototype,"tileInfo",void 0),Object(n.a)([Object(a.b)()],H.prototype,"extent",void 0),Object(n.a)([Object(a.b)()],H.prototype,"maximumByteSize",void 0),H=Object(n.a)([Object(c.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],H);class L{constructor(t,e,i){this.data=t,this.objectIds=e,this.byteSize=i}}class J{constructor(t,e,i){this.level=t,this.row=e,this.col=i,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}get hasChildren(){return!this.isLeaf&&(Object(r.i)(this.children[0])||Object(r.i)(this.children[1])||Object(r.i)(this.children[2])||Object(r.i)(this.children[3]))}}class V{constructor(t,e=[]){this.missingTiles=e,this.fullArea=0,this.coveredArea=0,this.fullArea=Object(I.b)(t.extent),this.coveredArea=this.fullArea}prepend(t){this.missingTiles=t.missingTiles.concat(this.missingTiles),this.coveredArea+=t.coveredArea,this.fullArea+=t.fullArea}}class D{constructor(t,e,i){this.tileInfo=t,this.extent=null,this.info=new V(e),Object(r.i)(i)&&(this.extent=Object(I.i)(i))}addMissing(t,e,i,s){const n={id:null,level:t,row:e,col:i};this.tileInfo.updateTileInfo(n,1),!Object(r.i)(n.extent)||Object(r.i)(this.extent)&&!Object(I.l)(this.extent,n.extent)||(this.info.missingTiles.push({data:n,resolution:s}),this.info.coveredArea-=Object(I.b)(n.extent))}}const G=.18751;let Q=class extends l.a.EventedAccessor{constructor(){super(...arguments),this.isInitializing=!0,this.whenSetup=Object(u.f)(),this.handles=new d.a,this.updatingHandles=new g.a,this.pendingApplyEdits=new Map}get updating(){return this.featureFetcher.updating||this.isInitializing||this.updatingHandles.updating}destroy(){this.featureFetcher.destroy(),this.queryEngine.destroy(),this.featureStore.clear(),this.handles.destroy()}setup(t){var e=this;return Object(s.a)(function*(){const{geometryType:i,objectIdField:s,timeInfo:n,fields:r}=t.serviceInfo;return e.featureStore=new y.a({...t.serviceInfo,hasZ:!1,hasM:!1}),e.queryEngine=new x.a({spatialReference:t.spatialReference,featureStore:e.featureStore,geometryType:i,fields:r,hasZ:!1,hasM:!1,objectIdField:s,timeInfo:n?p.a.fromJSON(n):null}),e.featureFetcher=new A({store:new H({featureStore:e.featureStore}),url:t.serviceInfo.url,objectIdField:t.serviceInfo.objectIdField,capabilities:t.serviceInfo.capabilities,spatialReference:h.a.fromJSON(t.spatialReference),sourceSpatialReference:h.a.fromJSON(t.serviceInfo.spatialReference)}),e.handles.add([e.featureFetcher.watch("availability",t=>e.emit("notify-availability",{availability:t}),!0),e.watch("updating",()=>e.notifyUpdating())]),e.whenSetup.resolve(),e.isInitializing=!1,e.configure(t.configuration)})()}configure(t){var e=this;return Object(s.a)(function*(){return yield e.updatingHandles.addPromise(e.whenSetup.promise),e.updateFeatureFetcherConfiguration(t),{result:{}}})()}fetchCandidates(t,e){var i=this;return Object(s.a)(function*(){return yield i.whenSetup.promise,Object(u.u)(e),{result:yield i.queryEngine.executeQueryForSnapping({point:t.point,distance:t.distance,types:t.types,query:Object(r.i)(t.filter)?t.filter:{where:"1=1"}},Object(r.i)(e)?e.signal:null)}})()}updateTiles(t,e){var i=this;return Object(s.a)(function*(){return yield i.updatingHandles.addPromise(i.whenSetup.promise),Object(u.u)(e),i.featureFetcher.tileSize=t.tileSize,i.featureFetcher.tilesOfInterest=t.tiles,i.featureFetcher.tileInfo=Object(r.i)(t.tileInfo)?b.a.fromJSON(t.tileInfo):null,{result:{}}})()}refresh(t,e){var i=this;return Object(s.a)(function*(){return yield i.updatingHandles.addPromise(i.whenSetup.promise),Object(u.u)(e),i.featureFetcher.refresh(),{result:{}}})()}whenNotUpdating(t,e){var i=this;return Object(s.a)(function*(){return yield i.updatingHandles.addPromise(i.whenSetup.promise),Object(u.u)(e),yield Object(u.x)(Object(f.i)(i,"updating"),e),{result:{}}})()}getDebugInfo(t,e){var i=this;return Object(s.a)(function*(){return Object(u.u)(e),{result:i.featureFetcher.debugInfo}})()}beginApplyEdits(t,e){var i=this;return Object(s.a)(function*(){i.updatingHandles.addPromise(i.whenSetup.promise),Object(u.u)(e);const s=Object(u.f)();return i.pendingApplyEdits.set(t.id,s),i.featureFetcher.applyEdits(s.promise),i.updatingHandles.addPromise(s.promise),{result:{}}})()}endApplyEdits(t,e){var i=this;return Object(s.a)(function*(){const s=i.pendingApplyEdits.get(t.id);return s&&s.resolve(t.edits),Object(u.u)(e),{result:{}}})()}updateFeatureFetcherConfiguration(t){this.featureFetcher.filter=Object(r.i)(t.filter)?m.a.fromJSON(t.filter):null,this.featureFetcher.customParameters=t.customParameters}notifyUpdating(){this.emit("notify-updating",{updating:this.updating})}};Object(n.a)([Object(a.b)({readOnly:!0})],Q.prototype,"updating",null),Object(n.a)([Object(a.b)()],Q.prototype,"isInitializing",void 0),Q=Object(n.a)([Object(c.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],Q),e.default=function(){return new Q}},ZRfE:function(t,e,i){"use strict";var s=i("srIe"),n=i("6S2I"),r=i("zlDU"),o=i("zm0L"),a=i("kYAx"),c=i("ZlUD"),u=i("QmHG"),h=i("BMSW"),l=i("k5I3"),d=i("gVKr"),f=i("2X7Z");const p={getObjectId:t=>t.objectId,getAttributes:t=>t.attributes,getAttribute:(t,e)=>t.attributes[e],cloneWithGeometry:(t,e)=>new l.a(e,t.attributes,null,t.objectId),getGeometry:t=>t.geometry,getCentroid:(t,e)=>(t.centroid||(t.centroid=Object(f.a)(new d.a,t.geometry,e.hasZ,e.hasM)),t.centroid)};e.a=class{constructor(t){this.geometryInfo=t,this._boundsStore=new h.a,this._featuresById=new Map,this._markedIds=new Set,this.events=new o.a,this.featureAdapter=p}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){if(!this.numFeatures)return null;const t=Object(a.e)(a.a);return this._featuresById.forEach(e=>{const i=this._boundsStore.get(e.objectId);i&&(t[0]=Math.min(i[0],t[0]),t[1]=Math.min(i[1],t[1]),t[2]=Math.max(i[2],t[2]),t[3]=Math.max(i[3],t[3]))}),t}get storeStatistics(){let t=0;return this._featuresById.forEach(e=>{e.geometry&&e.geometry.coords&&(t+=e.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:t/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}add(t){this._add(t),this._emitChanged()}addMany(t){for(const e of t)this._add(e);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(t){const e=this._featuresById.get(t);return e?(this._remove(e),this._emitChanged(),e):null}removeManyById(t){this._boundsStore.invalidateIndex();for(const e of t){const t=this._featuresById.get(e);t&&this._remove(t)}this._emitChanged()}forEachBounds(t,e,i){for(const s of t){const t=this._boundsStore.get(s.objectId);t&&e(Object(u.h)(i,t))}}getFeature(t){return this._featuresById.get(t)}has(t){return this._featuresById.has(t)}forEach(t){this._featuresById.forEach(e=>t(e))}forEachInBounds(t,e){this._boundsStore.forEachInBounds(t,t=>{e(this._featuresById.get(t))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let t=!1;this._featuresById.forEach((e,i)=>{this._markedIds.has(i)||(t=!0,this._remove(e))}),this._markedIds.clear(),t&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(t){if(!t)return;const e=t.objectId;if(null==e)return void n.a.getLogger("esri.layers.graphics.data.FeatureStore").error(new r.a("featurestore:invalid-feature","feature id is missing",{feature:t}));const i=this._featuresById.get(e);let o;if(this._markedIds.add(e),i?(t.displayId=i.displayId,o=this._boundsStore.get(e),this._boundsStore.delete(e)):Object(s.i)(this.onFeatureAdd)&&this.onFeatureAdd(t),!t.geometry||!t.geometry.coords||!t.geometry.coords.length)return this._boundsStore.set(e,null),void this._featuresById.set(e,t);o=Object(c.r)(o||Object(a.e)(),t.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(e,o),this._featuresById.set(e,t)}_remove(t){return Object(s.i)(this.onFeatureRemove)&&this.onFeatureRemove(t),this._markedIds.delete(t.objectId),this._boundsStore.delete(t.objectId),this._featuresById.delete(t.objectId),t}}},zna6:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i("srIe"),n=i("tQ+6"),r=i("ikTR"),o=i("RjdO");class a{constructor(t=9,e){this.compareMinX=l,this.compareMinY=d,this.toBBox=function(t){return t},this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&("function"==typeof e?this.toBBox=e:this._initFormat(e)),this.clear()}destroy(){this.clear(),O.prune(),j.prune(),v.prune(),I.prune()}all(t){this._all(this.data,t)}search(t,e){let i=this.data;const s=this.toBBox;if(y(t,i))for(O.clear();i;){for(let n=0,r=i.children.length;n<r;n++){const r=i.children[n],o=i.leaf?s(r):r;y(t,o)&&(i.leaf?e(r):b(t,o)?this._all(r,e):O.push(r))}i=O.pop()}}collides(t){let e=this.data;const i=this.toBBox;if(!y(t,e))return!1;for(O.clear();e;){for(let s=0,n=e.children.length;s<n;s++){const n=e.children[s],r=e.leaf?i(n):n;if(y(t,r)){if(e.leaf||b(t,r))return!0;O.push(n)}}e=O.pop()}return!1}load(t){if(!t.length)return this;if(t.length<this._minEntries){for(let e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}let e=this._build(t.slice(0,t.length),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=new S([]),this}remove(t){if(!t)return this;let e,i=this.data,r=null,o=0,a=!1;const c=this.toBBox(t);for(v.clear(),I.clear();i||v.length>0;){var u;if(i||(i=Object(s.c)(v.pop()),r=v.data[v.length-1],o=null!=(u=I.pop())?u:0,a=!0),i.leaf&&(e=Object(n.e)(i.children,t,i.children.length,i.indexHint),-1!==e))return i.children.splice(e,1),v.push(i),this._condense(v),this;a||i.leaf||!b(i,c)?r?(o++,i=r.children[o],a=!1):i=null:(v.push(i),I.push(o),o=0,r=i,i=i.children[0])}return this}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){let i=t;for(j.clear();i;){var s;if(!0===i.leaf)for(const t of i.children)e(t);else j.pushArray(i.children);i=null!=(s=j.pop())?s:null}}_build(t,e,i,s){const n=i-e+1;let r=this._maxEntries;if(n<=r){const s=new S(t.slice(e,i+1));return c(s,this.toBBox),s}s||(s=Math.ceil(Math.log(n)/Math.log(r)),r=Math.ceil(n/r**(s-1)));const o=new F([]);o.height=s;const a=Math.ceil(n/r),u=a*Math.ceil(Math.sqrt(r));x(t,e,i,u,this.compareMinX);for(let c=e;c<=i;c+=u){const e=Math.min(c+u-1,i);x(t,c,e,a,this.compareMinY);for(let i=c;i<=e;i+=a){const n=Math.min(i+a-1,e);o.children.push(this._build(t,i,n,s-1))}}return c(o,this.toBBox),o}_chooseSubtree(t,e,i,s){for(;s.push(e),!0!==e.leaf&&s.length-1!==i;){let i,s=1/0,n=1/0;for(let r=0,o=e.children.length;r<o;r++){const o=e.children[r],a=f(o),c=m(t,o)-a;c<n?(n=c,s=a<s?a:s,i=o):c===n&&a<s&&(s=a,i=o)}e=i||e.children[0]}return e}_insert(t,e,i){const s=i?t:(0,this.toBBox)(t);v.clear();const n=this._chooseSubtree(s,this.data,e,v);for(n.children.push(t),h(n,s);e>=0&&v.data[e].children.length>this._maxEntries;)this._split(v,e),e--;this._adjustParentBBoxes(s,v,e)}_split(t,e){const i=t.data[e],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);const r=this._chooseSplitIndex(i,n,s);if(!r)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const o=i.children.splice(r,i.children.length-r),a=i.leaf?new S(o):new F(o);a.height=i.height,c(i,this.toBBox),c(a,this.toBBox),e?t.data[e-1].children.push(a):this._splitRoot(i,a)}_splitRoot(t,e){this.data=new F([t,e]),this.data.height=t.height+1,c(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let s,n,r;s=n=1/0;for(let o=e;o<=i-e;o++){const e=u(t,0,o,this.toBBox),a=u(t,o,i,this.toBBox),c=g(e,a),h=f(e)+f(a);c<s?(s=c,r=o,n=h<n?h:n):c===s&&h<n&&(n=h,r=o)}return r}_chooseSplitAxis(t,e,i){const s=t.leaf?this.compareMinX:l,n=t.leaf?this.compareMinY:d;this._allDistMargin(t,e,i,s)<this._allDistMargin(t,e,i,n)&&t.children.sort(s)}_allDistMargin(t,e,i,s){t.children.sort(s);const n=this.toBBox,r=u(t,0,e,n),o=u(t,i-e,i,n);let a=p(r)+p(o);for(let c=e;c<i-e;c++){const e=t.children[c];h(r,t.leaf?n(e):e),a+=p(r)}for(let c=i-e-1;c>=e;c--){const e=t.children[c];h(o,t.leaf?n(e):e),a+=p(o)}return a}_adjustParentBBoxes(t,e,i){for(let s=i;s>=0;s--)h(e.data[s],t)}_condense(t){for(let e=t.length-1;e>=0;e--){const i=t.data[e];if(0===i.children.length)if(e>0){const s=t.data[e-1],r=s.children;r.splice(Object(n.e)(r,i,r.length,s.indexHint),1)}else this.clear();else c(i,this.toBBox)}}_initFormat(t){const e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}function c(t,e){u(t,0,t.children.length,e,t)}function u(t,e,i,s,n){n||(n=new S([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r,o=e;o<i;o++)r=t.children[o],h(n,t.leaf?s(r):r);return n}function h(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function l(t,e){return t.minX-e.minX}function d(t,e){return t.minY-e.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function g(t,e){const i=Math.max(t.minX,e.minX),s=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),r=Math.min(t.maxY,e.maxY);return Math.max(0,n-i)*Math.max(0,r-s)}function b(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function y(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function x(t,e,i,n,r){const a=[e,i];for(;a.length;){const e=Object(s.c)(a.pop()),i=Object(s.c)(a.pop());if(e-i<=n)continue;const c=i+Math.ceil((e-i)/n/2)*n;Object(o.a)(t,c,i,e,r),a.push(i,c,c,e)}}const O=new r.a,j=new r.a,v=new r.a,I=new r.a({deallocator:void 0});class _ extends class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}{constructor(){super(...arguments),this.height=1,this.indexHint=new n.a}}class S extends _{constructor(t){super(),this.children=t,this.leaf=!0}}class F extends _{constructor(t){super(),this.children=t,this.leaf=!1}}}}]);