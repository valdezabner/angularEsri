(window.webpackJsonp=window.webpackJsonp||[]).push([[121],{DlAm:function(e,t,r){"use strict";r.r(t);var a=r("HaE+"),s=r("pO5D"),n=r("wSAH"),u=r("f/qv"),l=r("nR38"),o=r("srIe"),i=(r("6S2I"),r("zqDF"),r("WbKI")),d=r("04ZG"),c=r("zlDU"),y=r("4EHJ"),p=(r("ju1D"),r("9AIY"),r("OvF4")),b=r("Lqtk"),h=r("bV/r"),m=r("ZYtI"),f=r("iRQj"),O=r("2LKE"),g=r("/uz8"),F=r("iNG6");function j(){return(j=Object(a.a)(function*(e){return"string"==typeof e?Object(y.i)(e)||{data:e}:new Promise((t,r)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(Object(y.i)(a.result)),a.onerror=e=>r(e)})})).apply(this,arguments)}const I=new Set(["Feature Layer","Table"]);let R=class extends h.a{constructor(){super(...arguments),this.type="feature-layer"}load(e){const t=Object(o.i)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:t,dynamicDataSource:r,gdbVersion:a,spatialReference:s,fieldsIndex:u}=this.layer,l=Object(n.a)("featurelayer-pbf")&&e?"pbf":"json";return new g.a({url:t.path,format:l,fieldsIndex:u,dynamicDataSource:r,gdbVersion:a,sourceSpatialReference:s})}addAttachment(e,t){var r=this;return Object(a.a)(function*(){yield r.load();const a=e.attributes[r.layer.objectIdField],s=r.layer.parsedUrl.path+"/"+a+"/addAttachment",n=r._getLayerRequestOptions(),u=r._getFormDataForAttachment(t,n.query);try{const e=yield Object(b.default)(s,{body:u});return r._createFeatureEditResult(e.data.addAttachmentResult)}catch(l){throw r._createAttachmentErrorResult(a,l)}})()}updateAttachment(e,t,r){var s=this;return Object(a.a)(function*(){yield s.load();const a=e.attributes[s.layer.objectIdField],n=s.layer.parsedUrl.path+"/"+a+"/updateAttachment",u=s._getLayerRequestOptions({query:{attachmentId:t}}),l=s._getFormDataForAttachment(r,u.query);try{const e=yield Object(b.default)(n,{body:l});return s._createFeatureEditResult(e.data.updateAttachmentResult)}catch(o){throw s._createAttachmentErrorResult(a,o)}})()}applyEdits(e,t){var r=this;return Object(a.a)(function*(){yield r.load();const a=e.addFeatures.map(r._serializeFeature,r),s=e.updateFeatures.map(r._serializeFeature,r),n=r._getFeatureIds(e.deleteFeatures,null==t?void 0:t.globalIdUsed);Object(f.b)(a,s,r.layer.spatialReference);const u=[],l=[],o=[...e.deleteAttachments];for(const t of e.addAttachments)u.push(yield r._serializeAttachment(t));for(const t of e.updateAttachments)l.push(yield r._serializeAttachment(t));const i=u.length||l.length||o.length?{adds:u,updates:l,deletes:o}:null,d=r._getLayerRequestOptions({method:"post",query:{adds:a.length?JSON.stringify(a):null,updates:s.length?JSON.stringify(s):null,deletes:n.length?null!=t&&t.globalIdUsed?JSON.stringify(n):n.join(","):null,gdbVersion:(null==t?void 0:t.gdbVersion)||r.layer.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,attachments:i&&JSON.stringify(i)}}),c=yield Object(b.default)(r.layer.parsedUrl.path+"/applyEdits",d);return r._createEditsResult(c)})()}deleteAttachments(e,t){var r=this;return Object(a.a)(function*(){yield r.load();const a=e.attributes[r.layer.objectIdField],s=r.layer.parsedUrl.path+"/"+a+"/deleteAttachments";try{return(yield Object(b.default)(s,r._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(r._createFeatureEditResult)}catch(n){throw r._createAttachmentErrorResult(a,n)}})()}fetchRecomputedExtents(e={}){var t=this;return this.load({signal:e.signal}).then(Object(a.a)(function*(){const r=t._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:a,url:s}=t.layer,{data:n}=yield Object(b.default)(`${s}/${a}`,r),{id:u,extent:l,fullExtent:o,timeExtent:i}=n,d=l||o;return{id:u,fullExtent:d&&p.a.fromJSON(d),timeExtent:i&&m.a.fromJSON({start:i[0],end:i[1]})}}))}queryAttachments(e,t={}){var r=this;return Object(a.a)(function*(){const{parsedUrl:a}=r.layer,s=a.path;yield r.load();const n=r._getLayerRequestOptions(t);if(!r.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:t}=e,r=[];for(const e of t){const t=s+"/"+e+"/attachments";r.push(Object(b.default)(t,n))}return Promise.all(r).then(e=>t.map((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))).then(e=>Object(O.b)(e,s))}return r.queryTask.executeAttachmentQuery(e,n)})()}queryFeatures(e,t){var r=this;return Object(a.a)(function*(){return yield r.load(),r.queryTask.execute(e,{...t,query:{...r.layer.customParameters,...null==t?void 0:t.query}})})()}queryFeaturesJSON(e,t){var r=this;return Object(a.a)(function*(){return yield r.load(),r.queryTask.executeJSON(e,{...t,query:{...r.layer.customParameters,...null==t?void 0:t.query}})})()}queryObjectIds(e,t){var r=this;return Object(a.a)(function*(){return yield r.load(),r.queryTask.executeForIds(e,{...t,query:{...r.layer.customParameters,...null==t?void 0:t.query}})})()}queryFeatureCount(e,t){var r=this;return Object(a.a)(function*(){return yield r.load(),r.queryTask.executeForCount(e,{...t,query:{...r.layer.customParameters,...null==t?void 0:t.query}})})()}queryExtent(e,t){var r=this;return Object(a.a)(function*(){return yield r.load(),r.queryTask.executeForExtent(e,{...t,query:{...r.layer.customParameters,...null==t?void 0:t.query}})})()}queryRelatedFeatures(e,t){var r=this;return Object(a.a)(function*(){return yield r.load(),r.queryTask.executeRelationshipQuery(e,{...t,query:{...r.layer.customParameters,...null==t?void 0:t.query}})})()}queryRelatedFeaturesCount(e,t){var r=this;return Object(a.a)(function*(){return yield r.load(),r.queryTask.executeRelationshipQueryForCount(e,{...t,query:{...r.layer.customParameters,...null==t?void 0:t.query}})})()}_fetchService(e){var t=this;return Object(a.a)(function*(){let r=t.layer.sourceJSON;if(!r){const{data:a}=yield Object(b.default)(t.layer.parsedUrl.path,t._getLayerRequestOptions({query:Object(n.a)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:e}));r=a}t.sourceJSON=t._patchServiceJSON(r);const a=r.type;if(!I.has(a))throw new c.a("feature-layer-source:unsupported-type",`Source type "${a}" is not supported`)})()}_patchServiceJSON(e){var t;if("Table"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=Object(F.c)(e.geometryType).renderer;Object(l.c)("drawingInfo.renderer",t,e)}return e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return Object(o.h)(t)?{attributes:r}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:r}}_serializeAttachment(e){var t=this;return Object(a.a)(function*(){const{feature:r,attachment:a}=e,{globalId:s,name:n,contentType:u,data:l,uploadId:o}=a,i={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(r&&(i.parentGlobalId="attributes"in r?r.attributes&&r.attributes[t.layer.globalIdField]:r.globalId),o)i.uploadId=o;else if(l){const e=yield function(e){return j.apply(this,arguments)}(l);i.contentType=e.mediaType,i.data=e.data,l instanceof File&&(i.name=l.name)}return n&&(i.name=n),u&&(i.contentType=u),i})()}_getFeatureIds(e,t){const r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):"objectId"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map(e=>e.attributes&&e.attributes[t])}_canUseGlobalIds(e,t){return e&&"globalId"in t[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map(e=>e.objectId)}_getGlobalIdsFromFeatureIdentifier(e){return e.map(e=>e.globalId)}_createEditsResult(e){const t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new c.a("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){return{objectId:e,globalId:null,error:new c.a("feature-layer-source:attachment-failure",t.details.messages&&t.details.messages[0]||t.message,{code:t.details.httpStatus||t.details.messageCode})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const a in t){const e=t[a];null!=e&&(r.set?r.set(a,e):r.append(a,e))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:r,dynamicDataSource:a}=this.layer;return{...e,query:Object(u.c)({gdbVersion:r,layer:a?JSON.stringify({source:a}):void 0,...t.query,f:"json",...this.layer.customParameters,...null==e?void 0:e.query}),responseType:"json"}}};Object(s.a)([Object(i.b)()],R.prototype,"type",void 0),Object(s.a)([Object(i.b)({constructOnly:!0})],R.prototype,"layer",void 0),Object(s.a)([Object(i.b)({readOnly:!0})],R.prototype,"queryTask",null),R=Object(s.a)([Object(d.a)("esri.layers.graphics.sources.FeatureLayerSource")],R),t.default=R},iNG6:function(e,t,r){"use strict";r.d(t,"a",function(){return l}),r.d(t,"b",function(){return o}),r.d(t,"c",function(){return u});var a=r("wSAH"),s=r("f/qv"),n=r("gkbi");function u(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?n.a:"esriGeometryPolyline"===e?n.c:n.b}}}function l(e,t){if(Object(a.a)("csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const t in e)r+=`this${t.indexOf(".")?`["${t}"]`:`.${t}`} = ${JSON.stringify(e[t])};`;const a=new Function(r);return()=>new a}catch(r){return()=>({[t]:null,...e})}}function o(e={}){return[{name:"New Feature",description:"",prototype:{attributes:Object(s.a)(e)}}]}}}]);